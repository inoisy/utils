# Структура

Дополнительную информацию о структуре можно прочитать в [официальном руководстве](https://nuxtjs.org/guide/directory-structure). Здесь же более подробно будет описана структура, которая используется на наших проектах.

Помимо необходимых файлов конфигураций и зависимостей, папка `frontend` содержит следующие директории:

1. `assets/` - содержит нескомпилированные файлы с исходным кодом глобальных стилей, скриптов, шрифтов и картинок.
    - `fonts/` - в этой папке будут лежать необходимые шрифты проекта. Подключение шрифтов осуществляется с помощью миксина `font` в файле `_fonts.scss` (см. секцию `scss`)
    - `images/` - служит для картинок, которые будет необходимо прогнать через webpack. В следующих версиях стартового шаблона данная папка может быть удалена, тк в большинстве случаев достаточно использовать папку `static`.
    - `js/` - содержит папки для js-классов, vue-директив, vue-миксинов и  различных утилит.
        - `classes/` - здесь должны быть объявлены все js-клаасы, которые будут использоваться на проекте
        - `directives/` - здесь добавляются vue-директивы, которые потом объявляются в файле `index.js` в этой же папке.
        - `mixins/` - здесь добавляются vue-миксины для проекта.
        - `utils/` - в данной папке содержаться все вспомогательные функции и утилиты. Шаблон проекта уже содержит набор из наиболее часто используемых функций.
    - `scss/` - содержит глобальные стили проекта и библиотек, переменные и scss-миксины. Внутри этой папки должно лежать 2 файла `common.scss` - для импорта общих файлов из папки `common` и описания глобальных стилей, и  `vendors.scss` - для импорта файлов библиотек.
        - `common/` - включает четыре файла `_fonts.scss` - для установки шрифтов, `_reset.scss` - дополнительный сброс браузерных стилей,  `_text.scss` - для описания типографики на всем проекте, `_transitions.scss` - используется для добавления общих на всем проекте анимаций компонента `<transition>`
        - `shared/` - в этой папке хранится три файла `_functions.scss` - вспомогательные функции, `_mixins.scss` - миксины, `_variables.scss` - переменные для проекта. Все эти файлы обрабатываются через [style-resources-loader](https://github.com/yenshih/style-resources-loader) и доступны в любом компоненте без необходимости импорта.
        - `vendors/` - здесь должны быть объявлены scss файлы по имени импортируемой библиотеки. После импорта файлов самой библиотеки следует переопределение ее стилей.
2. `components/` - директория, в которой хранятся все компоненты проекта, от страничный блоков до ui-компонентов.
    - `common/` - в этой папке должны быть объявлены общие компоненты на весь проект. Общим можно считать такой компоненты, который встречается минимум на двух разный страницах.
    - `icons/` - сюда стоит выносить все компоненты, содержащие svg иконки
    - `layout/` - это папка является частный случаем общих компонентов, сюда стоит добавлять компоненты хедера, сайдбара, футера и тп.
        - `modals/` - отдельно выносится папка для компонентов модальных окон. Если модальное окно не является общим для всего проекта, а встречается исключительно на какой-то странице, то компоненто этого модального окна объявляется в структуре компонентов странице.
    - `ui/` - содержит все ui-элементы проекта (кнопки, дропдауны, табы и т.д.). Данные компоненты являются стандартизированным. Готовые решения и процесс разработки можно найти в [репозитории](https://gitlab.com/Bolten/dev-components) и [демо](http://uikit.idacloud.ru/).
3. `config/` включается в себя файлы для конфигурации `nuxt.config.js`. `proxy.js` набор правил для проксирования запросов, используется в основном для локальной разработки. `plugins.js` список плагинов, который будут зарегистрированы в nuxt. 
    - `plugins/` - содержит JavaScript-плагины. (Раньше папка располагалась в корне проекта, согласно официальной документации. На данной момент идет тестирование новой структуры)
    - `modules/` - содержит модули
    - `head/` - содержит мета итп 
    - `api/` - запросы в бэк (паттерн репозиторий?)
4. `layouts/` - содержит компоненты для определения шаблонов страниц.
5. `pages/` - содержит компоненты страниц. Для каждой страницы необходимо создавать отдельную директорию внутри которой будет создан файл `index.vue`
6. `static/` - содержит статические файлы. Каждый файл в этой папке доступен через `/`.  
    - `favicons/` - в этой папке будут лежать сгенерированные фавиконки. Для генерации используем этот [сервис](https://realfavicongenerator.net/).
7. `store/` - содержать файлы Vuex хранилища. Для добавления модулей папка `modules` НЕ нужна.

---

## Взаимодействие с бекендом

В зависимости от реализации на бекенде, взаимодействие с API осуществляется либо методами REST, либо с помощью GraphQL. Для реализации обоих подходов на фронте используется axios.

### REST

Для взаимодействия с REST API необходимо добавить все api-маршруты в файл `config/plugins/api.js`, а затем подключить этот файл в `/config/plugins.js`. В `.env` файл добавить переменную `PROXY_URL`, которая должна содержать адрес дев-сервера, с развернутым API (`PROXY_URL=https://my-site.ru/`).

При SSR запросы будут отправляться на адрес, указанный в `PROXY_URL`. При CSR запросы отправляются на `location.origin` и разрешаются с помощью проксирования. Настройки прокси можно посмотреть в `config/proxy.js`.

Теперь, при отправки запроса достаточно обратиться к `app.$api` (SSR) или `this.$api` (CRS), чтобы получить объект объявленных маршрутов, выбрать необходисый маршурт и передать его в axios. 

### GraphQL

Для работы с graphql убедитесь, что у вас установлены пакеты `graphql` и `graphql-tag`. После этого в `nuxt.config.js` необходимо добавить секцию:

```jsx
extend(config, ctx) {
		config.module.rules.push({
				test: /\.(graphql|gql)$/,
				exclude: /node_modules/,
				loader: 'graphql-tag/loader',
		});
}
```

